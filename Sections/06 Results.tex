\section{Results and discussion}\label{sec:ResultsDiscussion}

\textit{Results in 2 parts.
1. part analyzise
2. part future steps}


\subsection{Human factors results}
Discuss how a high stable latency could be more acceptable than a low unstable latency due to info found in Theory, Human Factors.


Its important to include how humans act in different scenarios, as regardless of the systems, the remote operator will always be a constant high latency of atleast 500 - 1000 ms \cite{ouden2022}. And how they react to a possible system latency will also be crucial for the full remote operation.
\import{./Tables/}{HumanFactorResults}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cite{brandenburger2023vqreactiontimertc}
- Evaluates latency by performance, (human) IRL

Test of human factors and realiable communcations via 5g
"Limited literature on:" 
"Positive effect of bitrate on quaility", "Stalling has worse effect on QoExperience, if bitrate is higher"
"Higher frame rate not linked to information assimiliation, but increased user enjoyment"

Tested with three different levels of bitrate
1, 6, 24 Mbps
5, 15, 25 FPS
Stimulus
Light signal, Distance marker

MeasurementsResponce accuracyResponce speed

Study 1:
Higher bitrate -> faster answears, more correct
Higher FPS -> same speed on answear, same amount of correct
Study 2:
Higher bitrate -> same speed on answears, more correct
Higher FPS -> same speed on answear, same amount of correct

Bitrate is more important (source 5 in PP: https://dl.acm.org/doi/abs/10.1145/2072298.2072351)
Stimulus type:
Distance marker signs where answeared faster and more correct than light signals
5000 -> 3000 speed, and 0.51 -> 0.58 and 0.61 -> 0.69

This is promosing new with the implementation of ERTMS as the only input stimulus in signalling threw camera and video stream will be signs as the remote control operatior will get the ETCS directly in the control room. 
After certain bitrate less helpful
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cite{ouden2022}
- Evaluates Latency by performance, (people) IRL  

- Evaluate Latency threshold on SIMulation

- 4G and 5G 
- 4 times 120 angle camera
- H.264
- Split latency up into Control and video and does
- min, mean, 95\%ile, max latency in ms

- Speed of 10, 20, 30 and 40km/h
100 manual test runs for benchmark
180 runs of RC with 4G
300 runs of RC with 5G 
One Trip Latency.” Every unit
was time synchronized with a GPS-PPP source.
Packets logged using tcpdump.


Includes a test that results in at 300ms, you get loss of performance, and at 1000ms the delay becomes unfeasible.

Did not find resonable difference in the latencies of straight acceleration test. 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\cite{jernberg2024}
"However, it also seems to be the case that remote operators adapt to the circumstances they find themselves in; for example, they drive with a safety margin reducing risks to their personal chosen limit and do not override the barriers of their own choice."

"The reaction time in H1 (a car cutting in into the ego lane) increased more for each latency condition than the offset in time that the manipulation created. This suggests that even an unperceived increase in latency (based on subjective ratings) is affecting the participants in a way that makes them less observant of their surroundings. Combined with a self-reported decline in performance and control as the latency increases, a conclusion could be that the added mental workload is turning the primary driving task into a distraction in itself, by forcing the operator to devote an unusual amount of attention just to maintain speed and lane position."



\subsubsection{Adaptation to stable latency.} % Må endre tittel
Jernberg(2024) 
"Fixed latency seems to be better than varied latency" (Davis et al., 2010, Gnatzig et al., 2013) 

Gorsich et al. (2018) found that a higher latency results in more inaccurate behavior, with a drastic decrease starting at a latency of 600 ms, and Gnatzig et al. (2013) found that a constant latency of 500 ms was unproblematic for drivers when the vehicle was steadily kept at 30 km/h on their track. 
\cite{jernberg2024}

(Neumier 2019)
Could not confirm that fixed latency resultet in any better result than varied latency.
Could not confirm "Kang et al" \cite{kang2018} who stated that fixed latency leads to better driving performance than varying. \cite{neumeier2019}
% Kang did not at all mention fixed vs variable latencies. 

In the event of offloading a truck with a crane, the participents where exposed to constant levels of latency, and showing that delaly of joystick all the way up to 480 ms was basicly irrelevant for QoE and the results of task done pr time. However a delay of 880 significantly reduced the performance overall by atleast halfing the rating on the scores (1-5).
\cite{brunnström2020}


\subsection{Comparing latency for different vehicles}

After reading threw an  reasearch paper on the topic of how latency treshold are set. It became apparent to me that very few have done enhanced research on this very topic for railway remote control. Papers such as XX, who mentions anything about the maximum latency before loosing performance reference sources of other vehicles and their tests of remote control. 
\import{./Tables/}{LatencyThresholdResults}

In the case of XX who reference Jernberg 2024 adn their findings of. Jernberg goes into details of the hazards and proxy hazards that the driver were facing. As mentionen in Section 4 "Related Work" \cite{jernberg2024}
How in control of the vehicle were you during the drive (1-5)
Baseline 3.7, 100ms 3.5, 200ms 2.9


The most referenced remote control latency effect paper, Neumeier's paper XX, talks about how participent leave the car lane significanlty more with higher latency, even tho with stable high latency. But:
"In the Parking scenario, even no differences for whatever latency could be revealed" \cite{neumeier2019}
Scenarios, was driving with turns, and one parking. No hazards except latency. 

\cite{fp2r2dato2024d41_2} % Need more information about bitsize + other
D41.2 - Testing reports \& assessment 
Results of the remote driving of tramways demonstrator. 
Image latency 
- G2G, (capturing processing, compression, transmission, reception, decompressing, displaying)
- Oslo to Berlin
- Two atomic clocks on phones.
- Measured to be 340 - 380 ms (Always under 400 ms)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cite{jürgensen2025rcrailvehicles}
- Finds actually latency in project
- Uses Car threshold to evaluate

Is a project in "Remote Control for Rail Vehicles" where they test a remote control train for a short track from "X" to "X" in Germany. Here they do "this" and found "that".

Says that at 300ms, you get loss of performance, and at 1000ms the delay becomes unfeasible.
And references: "Design and Evaluation of Remote Driving Architecture on 4G and 5G Mobile Networks" (Ouden, 2022) \cite{ouden2022}
Which references (Lane, 2002) and (Neumeier, 2019)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%
D41.2 - Testing reports \& assessment 
Results of the remote driving of tramways demonstrator. 
\cite{fp2r2dato2024d41_2}
- Finds actually latency

Image latency 
- G2G, (capturing processing, compression, transmission, reception, decompressing, displaying)
- Oslo to Berlin
- Two atomic clocks on phones.
- Measured to be 340 - 380 ms (Always under 400 ms)


Auxiliary circuit tests,
- Driver safety
- Remote wake up
- R driving loop
- R control commands
- R ...
Static functional tests,
- Start Tram, CERES,
- CERES do step 1.2.3\dots

Dynamis functional tests,
- CERES Local brakte test
- CERES Remote Brakte test 
- C Drive 5km/h 
- C Drive 100\% dont break max speed 
- C loose communication.
- C DSD brake sequence
- C Local driver break priority over remote.

Reaction Time,
reduction in time needed to perform spesific tram operations, fleet management and preparation, start-up and shut-down procedures, maintenance tasks, shunting. 
Time reduction in these processes are efficiency improvments.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cite{kozarevic2025}
- Finds actually latency in project
- Uses Car / Drone threshold to evaluate
Talks about the dangers of latency in high speed vehicles. Comparing it to drone operations.
Reference drone and says 100 ms
Reference Chen?, and Neumeier, 170 ms and 300 ms have minimal impact on remote operators.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Calculation of latency}
The measurements and therefore the calculations of latency is not easily done. Since its a fluctuating measurement that varies alot depending on the components in the system used, the way to calculate various on what the personens want to find. 


Very difficult from related works:
Real time video latency: \cite{kaknjo2018videolatency}
Here, the time of the visual event in front of
the camera is denoted as T1 and the time when the event
was detected on the receiving end as T2. The start of frame processing is denoted as T3.
\textit{TVL =(T1 - T1)-(T2 -T3)=T3 -T1}


\subsection{Threshold for acceptable latency}
Maybe include calculations of speed of train, compare to the previous and discuss a posible latency treshhold. End in that research on spesificly train drivers on railway should be tested.

Use this report \cite{fp2r2dato2023d5_4}


\subsection{Tools and protocols for remote control}

\import{./Tables/}{ToolsFactorResults}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\cite{mejias2024}
- Evaluate latency depending on parameters / tools
Compare:
- RTSP
- WebRTC Web Real time communication
as their Real-time Transport Protocol (RTP) protocol.
- E2E
- H.264

Methodology for latency measurement.
Network Time Protocol (NTP) is necessary to synchronize sender and receiver.
Server obtains the TS1 when image is captured. Adds it to the RTP packets generated after the encoding. Player retrieves the timestamp (TS1) from the RTP packets and compares it with the current time TS2 when the image is beeing displayed. To do this, you must retrive it from the package before the decoder and comapre it with the image comming out of the decoder. 

1 Capture: the camera captures an image together with the timestamp. The timestamp is added to the metadata of the image.
2 Encoding: the image is encoded into a H.264 bit stream. The metadata is maintained unaltered along the encoding process.
3 Encapsulation: the H.264 video stream is encapsulated into RTP payload. The capture timestamp is extracted from the metadata and added to the RTP header. For this, it is required both the RTP standard header and its RFC 8286 extension.
4 Sender: RTP packets are sent on the communication channel. In the case of RTSP, the player opens a connection with the sender. For WebRTC, a negotiation between the sender and receiver is performed through the signaling server to determine the communication route.

The player receives the RTP packets through RTSP or WebRTC and calculates the latency:
1 Receiver: it receives the RTP packets through the channel established with the media server.
2 Decapsulation: the original H.264 content is extracted from the RTP payload. In addition, the timestamp contained in the RTP header is extracted and added as metadata of the H.264 content.
3 Decoding: the H.264 content is decoded to retrieve the uncompressed image. The metadata is maintained unaltered along the decoding process.
4 Displaying: the image is displayed. Moreover, the timestamp is extracted from the metadata and subtracted from the current time to obtain the End-to-End latency. This is shown to the remote driver, who will consider it during the operations.

BITRATE 
Change bitrate regarding quality of output (jitter or packet loss). Bitrate vary between 5Mbps, 3.5Mbps, 2Mbps.
A change of 2\% packet loss and 500Hz / 1000Hz jitter.

implementation.
GStreamer framework. (Open source)
Pylon source from Basler element that capture of camera images and timestamps.
H.264 NVidia en/de coder. Provided by NVIDIA graphics cards. It is the key to enable bitrate adaption.
RTP H.264 pay/depay. For packaging encoded video signal into RTP packets, and RTP includes timestamp in header.

WebRTCbin. Allows communication via WebRTC, peer2peer, must connect to signaling server responsible for negotiation.
RTSP server/client. Manage connection and send/receive data.

Camera, Media server on Jetson Xavier (Either WebRTC or RTSP), Network equipment (switch or laptop simulating a router, allowing to evaluate against bandwith degradation). Computer as player and reciver.

Results
E2E, time after capture to the time before display
S2S, time in front of camera to time displayed on player image 

Measurments for each camera and alternating available bandwidth.
When enough bandwidth results in 150 ms S2S and <75 ms E2E 
Bandwidth of <=10 results in 570 ms - 1000 ms or pixelation freezing in both S2S and E2E

RTSP
Difference in S2S and E2E is approx 70 ms - 100 ms which is image capturing and displaying.

WebRTC is faster E2E but not S2S

RTSP with rate control
Allows the bandwidth to go past 7 Mbps that was issue before, although with high latency. 
Adjust itself back up again. Also we can see a shift in latency between latency when increased bitsize of video.  

%%%%%%%%%%%%%%%

\subsection{Theory v. Practical test}
Compare from the PreDraft of what expected result and hopes were, and discussing them with the information of what happend in the test and measurments.


\subsection{Future work}
- MJPEG vs H.264

- Offshore or other remote controlled vehicles that can shead light or contribute to remote control railway.

Differnt aspects of latency \textit{What is the difference}
Fixed, static v dynamic.

\begin{comment}




\subsection{Parameters for latency testing}
What parameters are we measuring. 
Latency, Jitter, Packet loss.

\subsection{Parameters for latency evaluation}
speed, distance, braking distance, reaction time, margin for error.

- Lateral Deviation
- Max Steering angle
- Out of Lane Ratio 
- Avg Speed 
- Acceleration 

\subsection{Calculations of parameters}

\end{comment}